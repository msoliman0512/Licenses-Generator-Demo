@using Licenses_Generator_DBFirst.EntityClasses
@using Licenses_Generator_Demo.Services
@using Microsoft.AspNetCore.Components.Web
@inject GovernoratesService GovernorateService
@inject CitiesService CityService

<div class="container">
    <h2>User Info</h2>
    <form class="was-validated">
        <div class="form-group">
            <label for="name">Full Name</label>
            <input type="text" class="form-control" id="name" placeholder="Enter your full name" name="name" pattern="([A-Za-z]{2,40})([ ]{0,1})+(([A-Za-z]{2,40})([ ]{0,1})+(([A-Za-z]{2,40})([ ]{0,1})+(([A-Za-z]{2,40})([ ]{0,1})+([A-Za-z]{2,40}))))" required>
            <div class="valid-feedback">Valid.</div>
            <div class="invalid-feedback">Please fill out this field.</div>
            <small id="emailHelp" class="form-text text-muted">Maximum words are 5.</small>
        </div>
        <div class="form-group">
            <label for="nat_id">National ID</label>
            <input type="text" class="form-control" id="nat_id" placeholder="Enter Your National ID" name="nat_id" pattern="(2|3)[0-9][1-9][0-1][1-9][0-3][1-9](01|02|03|04|11|12|13|14|15|16|17|18|19|21|22|23|24|25|26|27|28|29|31|32|33|34|35|88)\d\d\d\d\d" required>
            <div class="valid-feedback">Valid.</div>
            <div class="invalid-feedback">Please fill out this field.</div>
        </div>
        <div class="form-group">
            <label for="inputAddress">Address</label>
            <input type="text" class="form-control" id="inputAddress" placeholder="1234 Main St, Apartment, studio, or floor" required>
            <div class="valid-feedback">Valid.</div>
            <div class="invalid-feedback">Please fill out this field.</div>
        </div>
        @{
            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="inputState">Governorate</label>
                    <select id="inputState" class="form-control" @bind="@selectedGovernorateId" required>
                        <option hidden disabled selected value=""> -- Choose Your Governorate -- </option>
                        @if (governorates != null)
                        {
                            @foreach (var governorate in governorates)
                            {
                                <option value="@governorate.Id">@governorate.Name</option>
                            }
                        }
                    </select>
                    <div class="valid-feedback">Valid.</div>
                    <div class="invalid-feedback">Please Choose an Option.</div>
                </div>
                <div class="form-group col-md-4">
                    <label for="inputCity">City</label>
                    <select id="inputCity" class="form-control" required>
                        <option hidden disabled selected value=""> -- Choose Your City -- </option>
                        @if (selectedGovernorateId != null)
                        {
                            @if (cities != null)
                            {
                                int selectedGovernorateIdInt = int.Parse(selectedGovernorateId);
                                IEnumerable<CityEntity> selectedCities = from city in cities where city.GovernorateId == selectedGovernorateIdInt select city;
                                @foreach (var city in selectedCities)
                                {

                                    <option value="@city.Id"> @city.Name</option>


                                }
                            }
                        }s



                    </select>
                    <div class="valid-feedback">Valid.</div>
                    <div class="invalid-feedback">Please Choose an Option.</div>
                </div>
                <div class="form-group col-md-2">
                    <label for="inputZip">Zip</label>
                    <input type="text" class="form-control" id="inputZip" pattern="[0-9]{5}" required>
                </div>
            </div>
        }
        <div class="form-group form-check">
            <input type="checkbox" class="form-check-input" id="agree_check_box" name="agree_check_box" required>
            <label class="form-check-label" for="exampleCheck1">I confirm that the information given in this form is true, complete and accurate.</label>
            <div class="valid-feedback">Valid.</div>
            <div class="invalid-feedback">Check this checkbox to continue.</div>
        </div>
        <button type="submit" class="btn btn-primary">Submit</button>
    </form>
    @*<form action="/action_page.php" class="was-validated">
            <div class="form-group">
                <label for="name">Name:</label>
                <input type="text" class="form-control" id="name" placeholder="Enter your full name" name="name" pattern="(^[A-Za-z]{2,40})([ ]{0,1})([A-Za-z]{2,40})([ ]{0,1})([A-Za-z]{2,40})([ ]{0,1})([A-Za-z]{2,40})([ ]{0,1}([A-Za-z]{2,40})" required>
                <div class="valid-feedback">Valid.</div>
                <div class="invalid-tooltip">Please fill out this field.</div>
            </div>
            <div class="form-group">
                <label for="nat_id">National ID:</label>
                <input type="text" class="form-control" id="nat_id" placeholder="Enter Your National ID" name="nat_id" pattern="[0-9]{14}" required>
                <div class="valid-feedback">Valid.</div>
                <div class="invalid-feedback">Please fill out this field.</div>
            </div>
            <div class="form-group">
                <label for="governorate_drop_down"> Choose Your Governorate</label>
                <button class="btn btn-primary dropdown-toggle" id="gov_drpdwn" name="gov_drpdwn" type="button" data-toggle="dropdown">Governorate<span class="caret"></span></button>
                <ul class="dropdown-menu">
                    @if (governorates != null)
                    {
                        @foreach (var governorate in governorates)
                        {
                            <li><a href="#"></a>@governorate.Name</li>
                        }
                    }
                </ul>
            </div>
            <div class="form-group form-check">
                <label for="gov_drpdwn">
                    <input class="form-check-input" type="checkbox" id="gov_drpdwn" name="remember" required>  I confirm that the information given in this form is true, complete and accurate.
                    <div class="valid-feedback">Valid.</div>
                    <div class="invalid-feedback">Check this checkbox to continue.</div>
                </label>
            </div>
            <button type="submit" class="btn btn-primary">Submit</button>
        </form>*@
</div>
@code {
    public IEnumerable<GovernorateEntity> governorates;
    public IEnumerable<CityEntity> cities;

    protected override async Task OnInitializedAsync()
    {
        Task<IEnumerable<GovernorateEntity>> asyncGovernorates = GovernorateService.GetGovernoratesAsync();
        governorates = await asyncGovernorates;
        if (Utils.Utility.IsAnyProduct(governorates))
        {
            // Do something
        }
        else
        {

        }

        Task<IEnumerable<CityEntity>> asyncCities = CityService.GetCitiesAsync();
        cities = await asyncCities;
        if (Utils.Utility.IsAnyProduct(cities))
        {
            // Do something
        }
        else
        {

        }
    }

    // GovernorateEntity selectedGovernorate;
    string selectedGovernorateId;

    void SelectGovernorate(string governorateId)
    {
        selectedGovernorateId = governorateId;
    }

}